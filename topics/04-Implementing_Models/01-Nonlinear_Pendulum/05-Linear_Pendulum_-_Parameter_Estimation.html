<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Computational Environments and Toolchains</title>

    <!-- Bootstrap core CSS -->
    <link href="../../../style/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../../style/codehilite/css/default.css" rel="stylesheet">
    <link href="../../../style/misc/css/module.css" rel="stylesheet">
    <link href="../../../style/misc/css/practical.css" rel="stylesheet">

	<script type="text/javascript"
	  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>

  </head>

<body>

	<!-- Fixed navbar -->
	<div class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			
			
	    	<div class="collapse navbar-collapse">

				<ul class="nav navbar-nav navbar-left">
					<!-- Moodle -->
					<li>
						<div class="navbar-header">
							<a class="navbar-brand" href="https://moodle.setu.ie/course/view.php?id=217428" target="_blank"><img height="18pt" src="../../../style/misc/img/moodle_logo_on_blue.gif" /></a>
						</div>						
					</li>
					<li>
						<div class="navbar-header">
							<a class="navbar-brand" href="https://ceandt202526.slack.com" target="_blank"><img height="15pt" src="../../../style/misc/img/slack_logo.png" /></a>
						</div>						
					</li>
				</ul>

	      		<ul class="nav navbar-nav navbar-right">

					<!-- module home -->
					<li>
						<div class="navbar-header">
							<a class="navbar-brand" href="../../../index.html"><span class="glyphicon glyphicon-home"></span></a>
						</div>						
					</li>
					
					<!-- topics -->
	        		<li>
						<div class="navbar-collapse collapse" id="b">
							<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
										<span class="glyphicon glyphicon-list-alt"></span>
									</a>
									<ul class="dropdown-menu" role="menu">
										<li class="dropdown-header">Topics</li>
										
									</ul>
								</li>
							</ul>
						</div>			
					</li>

					<!-- resources -->
	        		<li>
						<div class="navbar-collapse collapse" id="b">
							<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
										<span class="glyphicon glyphicon-th-list"></span>
									</a>
									<ul class="dropdown-menu" role="menu">
										<li class="dropdown-header">Resources</li>
										
										<li class="active">
											<a href="../../../topics/04-Implementing_Models/index.html#01-Nonlinear_Pendulum">Nonlinear Pendulum</a>
										</li>
										
										<li >
											<a href="../../../topics/04-Implementing_Models/index.html#02-Rocket_Launch">Rocket Launch</a>
										</li>
										
									</ul>
								</li>
							</ul>
						</div>			
					</li>
								
					<!-- pages-->
	        		<li>
						<div class="navbar-collapse collapse" id="c">
							<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
										<span>Linear Pendulum - Parameter Estimation</span
									</a>
									<ul class="dropdown-menu" role="menu">
										
										<li >
											<a href="00-Outline.html">Outline</a>
										</li>
										
										<li >
											<a href="01-Theory.html">Theory</a>
										</li>
										
										<li >
											<a href="02-Setup.html">Setup</a>
										</li>
										
										<li >
											<a href="03-Linear_Pendulum_-_Analytic.html">Linear Pendulum - Analytic</a>
										</li>
										
										<li >
											<a href="04-Linear_Pendulum_-_Numeric.html">Linear Pendulum - Numeric</a>
										</li>
										
										<li class="active">
											<a href="05-Linear_Pendulum_-_Parameter_Estimation.html">Linear Pendulum - Parameter Estimation</a>
										</li>
										
										<li >
											<a href="06-Nonlinear.html">Nonlinear</a>
										</li>
										
										<li >
											<a href="09-Period.html">Period</a>
										</li>
										
										<li >
											<a href="10-Assignment.html">Assignment</a>
										</li>
										
									</ul>
								</li>
							</ul>
						</div>			
					</li> 
					
	        	</ul>
			</div>
		</div>
	</div>

	<!-- contents -->
	<div class="container">
		
		<ul class="pager">
			
			<li class="previous"><a href="04-Linear_Pendulum_-_Numeric.html">&larr; Previous (Linear Pendulum - Numeric)</a></li>
			
			
			
			<li class="next"><a href="06-Nonlinear.html">Next (Nonlinear) &rarr;</a></li>
			
		</ul>
		
		<h1>Linear Pendulum - Parameter Estimation</h1>
<p><em>In this page we cover estimating parameters from noisy data using curve fitting.</em></p>
<p>Create a text cell and enter a level 2 heading with title <em>Linear Pendulum (Parameter Estimation)</em>.</p>
<h2>Summary</h2>
<p>Consider the problem of recording (noisy) data for a pendulum with unknown parameter (say Length) and you want to estimate the length (or knowing the length you want to estimate acceleration due to gravity, \(g\)). For example, 
a plot of the <a href="files/linear_pe_01.txt">data file</a> is shown below. Assuming \(g=1\) determine best estimate for length, \(L\). </p>
<figure>
  <img src="files/linear_pe_01.png" alt="" width="70%" >
  <figcaption>Observed position over time.</figcaption>
</figure>

<h2>Problem Type: Curve Fitting</h2>
<p>Given a (noisy) dataset of \(x,y\) points, and a function \(f(x,param)\) determine the values of the parameters so that the error 
\[
    \sum_{\text{over all x points}} \bigg| f(x,\text{param}) - y \bigg|
\]
is minimised.</p>
<ul>
<li>To do this in python we, import the <code>curve_fit</code> function from <code>scipy</code></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
</code></pre></div></td></tr></table></div>

<ul>
<li>Define function, \(f\), </li>
<li>Call <code>curve_fit</code> with <ul>
<li>function \(f\), </li>
<li>the list of independent variables (for use this will be the time values) </li>
<li>the list of dependent variables (for use this will be the observed position values) </li>
<li>and optionally <ul>
<li>bounds on the parameter we are trying to fit</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Application to Linear Pendulum</h2>
<p>First we read in the data </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;linear_pe_01.txt&quot;</span><span class="p">)</span>
<span class="n">tValues</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">obsValues</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>

<p>and plot it to verify (generate above plot).</p>
<p>Next load in function <code>curve_fit</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
</code></pre></div></td></tr></table></div>

<p>Define the function \(f\) --- we want to determine the unknown parameter \(L\) so we have function </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">tValues</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">getLinearAnalytic</span><span class="p">(</span><span class="n">tValues</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>Note: I used <code>getLinearAnalytic</code> here, I could have used <code>getLinearNumeric</code> and would get the (nearly) same result.</p>
<p>Now call <code>curve_fit</code> and output results</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">param</span><span class="p">,</span> <span class="n">param_cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">tValues</span><span class="p">,</span> <span class="n">obsValues</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param_cov</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>The output is </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>[1.20649853] [[0.00042687]]
</code></pre></div></td></tr></table></div>

<p>The first number is the estimate for parameter \(L\), the second is a measure of the error in this estimate. Lets now compute the solution using this value for \(L\) and compare expected with observed</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">expValues</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">getLinearAnalytic</span><span class="p">(</span><span class="nx">tValues</span><span class="p">,</span><span class="nx">L</span><span class="p">=</span><span class="nx">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">plot</span><span class="p">(</span><span class="nx">tValues</span><span class="p">,</span><span class="w"> </span><span class="nx">obsValues</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="p">=</span><span class="s">&quot;observed&quot;</span><span class="p">)</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">plot</span><span class="p">(</span><span class="nx">tValues</span><span class="p">,</span><span class="w"> </span><span class="nx">expValues</span><span class="p">,</span><span class="w"> </span><span class="nx">label</span><span class="p">=</span><span class="s">&quot;expected ($L=%.3f$)&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">title</span><span class="p">(</span><span class="s">&quot;Observed and Expected position of pendulum&quot;</span><span class="p">)</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">ylabel</span><span class="p">(</span><span class="s">&quot;position&quot;</span><span class="p">)</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">xlabel</span><span class="p">(</span><span class="s">&quot;time $t$ (sec)&quot;</span><span class="p">)</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">legend</span><span class="p">()</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">savefig</span><span class="p">(</span><span class="s">&quot;linear_pe_fit_bad.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bbox_inches</span><span class="p">=</span><span class="s">&quot;tight&quot;</span><span class="p">)</span>
<span class="nx">plt</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>

<p>This gives us </p>
<figure>
  <img src="files/linear_pe_fit_bad.png" alt="" width="70%" >
  <figcaption>First attempt at fitting to determine L (not a good fit).</figcaption>
</figure>

<p>This is not good at all -- the fit algorithm got stuck in a local minimum. Lets help it along by giving bounds for the parameter \(L\).  Looking at the graph and work we did last week we see that the estimate for \(L\) is too large. Lets force a search between [0,1].</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">param</span><span class="p">,</span> <span class="n">param_cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">tValues</span><span class="p">,</span> <span class="n">obsValues</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param_cov</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>which generates </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>[0.59987008] [[1.77914235e-07]]
</code></pre></div></td></tr></table></div>

<p>and looking at the graph, this is much better fit.</p>
<figure>
  <img src="files/linear_pe_fit_good.png" alt="" width="70%" >
  <figcaption>Second attempt at fitting to determine L.</figcaption>
</figure>

<h3>Exercise</h3>
<p>For each of the following datasets determine the optimal value for \(L\) </p>
<ul>
<li><a href="files/linear_pe__ex_00.txt">ex_00</a></li>
<li><a href="files/linear_pe__ex_01.txt">ex_01</a></li>
<li><a href="files/linear_pe__ex_02.txt">ex_02</a></li>
</ul>
		
		<ul class="pager">
			
			<li class="previous"><a href="04-Linear_Pendulum_-_Numeric.html">&larr; Previous (Linear Pendulum - Numeric)</a></li>
			
			
			
			<li class="next"><a href="06-Nonlinear.html">Next (Nonlinear) &rarr;</a></li>
			
		</ul>

	</div>
	
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../../style/bootstrap/js/bootstrap.min.js"></script>
	
  </body>
</html>